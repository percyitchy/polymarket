# ‚úÖ –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ –∞–ª–µ—Ä—Ç–æ–≤ Polymarket

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–µ–Ω Polymarket CLOB API

- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è: `PM_API_KEY`, `PM_API_SECRET`, `PM_API_PASSPHRASE`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º:
  - `[CLOB] API keys not configured, skipping /price endpoint`
  - –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –∫–ª—é—á–µ–π
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API (401/403/5xx) —Å fallback –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø—Ä–∏—á–∏–Ω—ã

### 2Ô∏è‚É£ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω HashiDive –∏ FinFeed fallback

- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ 429 (rate limit) —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∏—Å—Ç–æ—á–Ω–∏–∫—É
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ 5xx –æ—à–∏–±–æ–∫ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ fallback
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö `HASHDIVE_API_KEY` / `HASHIDIVE_API_KEY`
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `FINFEED_API_KEY`
- ‚úÖ –ü—É—Å—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–µ —Å—á–∏—Ç–∞—é—Ç—Å—è —Ñ–∞—Ç–∞–ª—å–Ω–æ–π –æ—à–∏–±–∫–æ–π, –ø—Ä–æ—Å—Ç–æ fallback

### 3Ô∏è‚É£ –£—Å–∏–ª–µ–Ω wallet_prices fallback

- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –¥–∞–∂–µ –ø—Ä–∏ –±–æ–ª—å—à–æ–º —Å–ø—Ä–µ–¥–µ (fail-open)
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
  - `[WALLET_FALLBACK] Using average price 0.615 from [0.51, 0.72]`
  - `[WALLET_FALLBACK] Skipped: wallet_prices empty or invalid`
- ‚úÖ –û–±–µ—Å–ø–µ—á–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ wallet_prices –∏–∑ `polymarket_notifier` ‚Üí `notify` ‚Üí `price_fetcher`

### 4Ô∏è‚É£ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–ø–æ—á–∫–∏

–í `price_fetcher.py`:
- ‚úÖ –ü–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —à–∞–≥–æ–º: `[PRICE_FETCH] Step 1/5: Polymarket CLOB API`
- ‚úÖ –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞: `[PRICE_FETCH] ‚úÖ Got price=0.512 from HashiDive`
- ‚úÖ –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö: `[PRICE_FETCH] ‚ùå Failed at FinFeed (timeout)`
- ‚úÖ –ü—Ä–∏ –ø–æ–ª–Ω–æ–º –ø—Ä–æ–≤–∞–ª–µ: `[PRICE_FETCH] ‚ùó All sources failed ‚Äî returning None`

### 5Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ fail-open –≤ polymarket_notifier.py

- ‚úÖ –ï—Å–ª–∏ `market_active == True` –∏ `current_price == None` ‚Üí –∞–ª–µ—Ä—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å `Price: N/A` (–Ω–µ suppressed)
- ‚úÖ Suppressed –∞–ª–µ—Ä—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è:
  - –∑–∞–∫—Ä—ã—Ç—ã—Ö/—Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Ä—ã–Ω–∫–æ–≤ (`market_closed` / `resolved`)
  - cooldown / duplicates
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ª–æ–≥: `[FAIL-OPEN] Market active but price=None ‚Äî continuing alert with Price: N/A`

### 6Ô∏è‚É£ –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç test_random_market_prices.py

- ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ 10 —Å–ª—É—á–∞–π–Ω—ã—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä—ã–Ω–∫–æ–≤ –∏–∑ `https://data-api.polymarket.com/markets`
- ‚úÖ –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—ã–∑—ã–≤–∞–µ—Ç `get_current_price()` —Å `outcome_index=0`
- ‚úÖ –ü–µ—á–∞—Ç–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
- ‚úÖ –í –∫–æ–Ω—Ü–µ —Å–≤–æ–¥–∫–∞: —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω–æ / –±–µ–∑ —Ü–µ–Ω—ã / –æ—à–∏–±–∫–∏

### 7Ô∏è‚É£ –°–µ—Ä–≤–∏—Å –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω

- ‚úÖ –§–∞–π–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- ‚úÖ –°–µ—Ä–≤–∏—Å –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

## üìä –ü–æ—Ä—è–¥–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —Ü–µ–Ω (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

1. **Polymarket CLOB API /price** (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é)
2. **HashiDive API** (—Ç—Ä–µ–±—É–µ—Ç API –∫–ª—é—á)
3. **–ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫** (data-api + clob) - –ø—É–±–ª–∏—á–Ω—ã–π
4. **FinFeed API** (—Ç—Ä–µ–±—É–µ—Ç API –∫–ª—é—á)
5. **–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –∏–∑ wallet_prices** - fail-open fallback

## üîç –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞:

```
[PRICE_FETCH] Step 1/5: Polymarket CLOB API
[PRICE_FETCH] [1/5] Requesting Polymarket CLOB API /price: token_id=...
[PRICE_FETCH] [1/5] Response status: 200
[PRICE_FETCH] ‚úÖ Got price=0.512 from Polymarket CLOB API
```

–∏–ª–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ:

```
[PRICE_FETCH] ‚ùå Failed at CLOB API (401 authentication failed): ...
```

### –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤ –¥–ª—è wallet_prices fallback:

```
[PRICE_FETCH] Step 5/5: wallet_prices fallback
[WALLET_FALLBACK] Trying wallet_prices fallback (provided 2 wallet prices)...
[WALLET_FALLBACK] wallet_prices content: {'0xabc...': 0.51, '0xdef...': 0.72}
[WALLET_FALLBACK] Valid prices extracted: [0.51, 0.72] (from 2 total)
[WALLET_FALLBACK] Using average price 0.615 from [0.51, 0.72]
[PRICE_FETCH] ‚úÖ Got price=0.615 from wallet_prices fallback
```

### –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤ –¥–ª—è fail-open:

```
[FAIL-OPEN] Market active but price=None ‚Äî continuing alert with Price: N/A
```

## ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ –õ—é–±–æ–π –∞–∫—Ç–∏–≤–Ω—ã–π —Ä—ã–Ω–æ–∫ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ü–µ–Ω—É –∏–∑ –æ–¥–Ω–æ–≥–æ –∏–∑ 5 –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- ‚úÖ –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ä–µ–¥–Ω—è—è –∏–∑ wallet_prices
- ‚úÖ –ï—Å–ª–∏ —Ä—ã–Ω–æ–∫ –∞–∫—Ç–∏–≤–µ–Ω, –Ω–æ —Ü–µ–Ω–∞ None ‚Äî –∞–ª–µ—Ä—Ç —Å `Price: N/A` (–Ω–µ suppressed)
- ‚úÖ Suppressed –∞–ª–µ—Ä—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞–∫—Ä—ã—Ç—ã—Ö/—Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Ä—ã–Ω–∫–æ–≤
- ‚úÖ –õ–æ–≥–∏ —è—Å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, –∫–∞–∫–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–ª —Ü–µ–Ω—É, –∞ –∫–∞–∫–æ–π –Ω–µ—Ç

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:

```bash
cd /opt/polymarket-bot
python3 test_random_market_prices.py
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω –¥–ª—è 10 —Å–ª—É—á–∞–π–Ω—ã—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä—ã–Ω–∫–æ–≤ –∏ –≤—ã–≤–µ–¥–µ—Ç —Å–≤–æ–¥–∫—É.

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- Fail-open –ª–æ–≥–∏–∫–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ä—ã–Ω–∫–∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ü–µ–Ω—ã
- wallet_prices fallback –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—Å–µ API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã

