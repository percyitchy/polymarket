# Проблема с получением цен рынков Polymarket

## Контекст проекта

Я разрабатываю систему мониторинга и алертинга для платформы предсказательных рынков Polymarket. Система отслеживает сделки высокопроизводительных трейдеров и отправляет алерты в Telegram при обнаружении консенсуса (когда несколько трейдеров одновременно покупают один и тот же исход рынка).

## Текущая проблема

### Основная проблема
CLOB API Polymarket (`https://clob.polymarket.com/markets/{condition_id}`) возвращает **HTTP 404 (market not found)** для закрытых или удаленных рынков. Это означает, что мы не можем получить текущую цену рынка через основной API.

### Примеры из реальных данных
- `condition_id: 0x8404e511c4018ce709291c768824b49651d8713c8abdab85b19b7ee82a09d0d` → 404
- `condition_id: 0xa201124f1421c39673f834dc55f82560d3b7734772254f9e72fcb35fe441d41f` → 404

### Текущая реализация

Мы используем следующий fallback-подход для получения цены:

1. **CLOB API** (основной метод)
   - URL: `https://clob.polymarket.com/markets/{condition_id}`
   - Проблема: возвращает 404 для закрытых рынков
   - Поля с ценой: `tokens[outcome_index].last_price`, `tokens[outcome_index].price`, `tokens[outcome_index].mark_price`

2. **HashiDive API** (fallback, опционален)
   - Метод: `get_last_price(asset_id)` где `asset_id = "{condition_id}:{outcome_index}"`
   - Статус: **Временно недоступен** (API ключ отсутствует)

3. **Средняя цена из wallet_prices** (fallback)
   - Используем цены из сделок кошельков, которые мы отслеживаем
   - Формула: `avg_price = sum(prices) / len(prices)`
   - Ограничение: работает только если у нас есть данные о сделках

4. **Polymarket data-api** (последний резерв)
   - URL: `https://data-api.polymarket.com/markets/{condition_id}`
   - Статус: не всегда доступен или возвращает те же данные

### Что нам нужно

**Вопрос к ChatGPT:**

Где еще можно получать данные о ценах рынков Polymarket, особенно для закрытых или недавно закрытых рынков?

**Конкретные вопросы:**

1. **Альтернативные API endpoints Polymarket:**
   - Есть ли другие официальные API для получения цен?
   - Существуют ли GraphQL endpoints?
   - Есть ли публичные WebSocket потоки с ценами?

2. **Сторонние сервисы:**
   - Какие сервисы агрегируют данные Polymarket?
   - Есть ли публичные API для исторических данных?
   - Какие альтернативы HashiDive существуют?

3. **Прямое получение данных:**
   - Можно ли получать цены через веб-скрапинг (если API недоступен)?
   - Есть ли публичные индексаторы блокчейна для получения данных о рынках?
   - Можно ли использовать The Graph или другие децентрализованные индексаторы?

4. **Исторические данные:**
   - Где хранятся исторические данные о закрытых рынках?
   - Есть ли архивы цен для разрешенных рынков?

### Технические детали

**Формат данных, который нам нужен:**
- `condition_id`: уникальный идентификатор рынка (hex string, 66 символов)
- `outcome_index`: индекс исхода (0, 1, 2, ...)
- `price`: текущая цена исхода (float, 0.0 - 1.0)
- `timestamp`: время последнего обновления цены

**Требования:**
- API должен быть публично доступным или иметь бесплатный tier
- Должен поддерживать запросы по `condition_id`
- Желательно низкая задержка (< 5 секунд)
- Желательно поддержка исторических данных

### Текущий стек технологий

- **Язык:** Python 3
- **HTTP клиент:** `requests`, `httpx`
- **API клиенты:** кастомные обертки для Polymarket и HashiDive
- **База данных:** SQLite
- **Логирование:** стандартный `logging` модуль

### Ограничения

- Нет доступа к платным API (только бесплатные/публичные)
- Предпочтительно REST API (но готовы к GraphQL/WebSocket)
- Нужна надежность (fallback должен работать даже при сбоях основного API)

---

**Пожалуйста, предложите конкретные решения с примерами URL, форматов запросов и ответов, если возможно.**

