# üß™ test_random_market_prices.py

## –û–ø–∏—Å–∞–Ω–∏–µ

–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —Ü–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ –∞–ª–µ—Ä—Ç–æ–≤ Polymarket:
- Polymarket CLOB API /price
- HashiDive API
- FinFeed API
- –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫ (trades)
- wallet_prices fallback

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫

```bash
python3 test_random_market_prices.py
```

–¢–µ—Å—Ç–∏—Ä—É–µ—Ç 10 —Å–ª—É—á–∞–π–Ω—ã—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä—ã–Ω–∫–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

### –° –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

```bash
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å 5 —Ä—ã–Ω–∫–æ–≤
python3 test_random_market_prices.py --limit 5

# –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–µ—Å—Ç 3 —Ä–∞–∑–∞
python3 test_random_market_prices.py --repeat 3

# –ö–æ–º–±–∏–Ω–∞—Ü–∏—è
python3 test_random_market_prices.py --limit 10 --repeat 5
```

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

- `--limit N` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—ã–Ω–∫–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10)
- `--repeat N` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π —Ç–µ—Å—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1)

## –í—ã–≤–æ–¥

### –§–æ—Ä–º–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä—ã–Ω–∫–∞:

```
Market: Will the government shutdown end November 8‚Äì11?
Condition ID: 0xec21462ef58f792b5c1ff07bfdc66401b631c6fb42562ccceb2de279f0e73788
Outcome: 0 (BUY)
‚Üí Price: 0.534  [Source: HashiDive] (180ms)
```

### –°–≤–æ–¥–∫–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏:

```
üìà –°–≤–æ–¥–∫–∞ (–∏—Ç–µ—Ä–∞—Ü–∏—è 1):
‚úÖ –£—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω–æ: 8
‚ö†Ô∏è  –ë–µ–∑ —Ü–µ–Ω—ã: 2
‚ùå –û—à–∏–±–∫–∏: 0

üìä –ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Ü–µ–Ω:
   trades: 5
   HashiDive: 2
   wallet_fallback: 1
```

### –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ (–ø—Ä–∏ --repeat):

```
üìä TEST SUMMARY (–≤—Å–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏)
================================================================================
‚úÖ Success: 24
‚ö†Ô∏è  Missing price: 6
‚ùå Errors: 0

üìä –ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Ü–µ–Ω (–≤—Å–µ–≥–æ):
   trades: 15 (62.5%)
   HashiDive: 6 (25.0%)
   wallet_fallback: 3 (12.5%)

‚è±Ô∏è  –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞: 245ms
```

## –ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Ü–µ–Ω

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞:

1. **CLOB** - Polymarket CLOB API /price (—Ç—Ä–µ–±—É–µ—Ç PM_API_KEY, PM_API_SECRET, PM_API_PASSPHRASE)
2. **HashiDive** - HashiDive API (—Ç—Ä–µ–±—É–µ—Ç HASHDIVE_API_KEY)
3. **trades** - –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫ –∏–∑ data-api.polymarket.com/trades (–ø—É–±–ª–∏—á–Ω—ã–π)
4. **FinFeed** - FinFeed API (—Ç—Ä–µ–±—É–µ—Ç FINFEED_API_KEY)
5. **wallet_fallback** - –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –∏–∑ wallet_prices (—Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ: 0.51, 0.72)

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ —à–∞–≥–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ `get_current_price()` —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `[PRICE_FETCH]`:

- `[PRICE_FETCH] Step 1/5: Polymarket CLOB API`
- `[PRICE_FETCH] ‚úÖ Got price=0.512 from HashiDive`
- `[PRICE_FETCH] ‚ùå Failed at FinFeed (timeout)`

## Fallback –ª–æ–≥–∏–∫–∞

–ï—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Ä—ã–Ω–∫–æ–≤, —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ condition_id:
- Eagles vs. Packers
- Lakers vs. Hornets
- MicroStrategy BTC purchase

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

```bash
python3 test_random_market_prices.py --limit 20
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

```bash
python3 test_random_market_prices.py --limit 10 --repeat 5
```

### –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

```bash
python3 test_random_market_prices.py --limit 3
```

## –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

- **‚úÖ Success** - –¶–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω–∞ –∏–∑ –æ–¥–Ω–æ–≥–æ –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- **‚ö†Ô∏è Missing price** - –í—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –≤–µ—Ä–Ω—É–ª–∏ None (—Ä—ã–Ω–æ–∫ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–∫—Ä—ã—Ç/—Ä–∞–∑—Ä–µ—à–µ–Ω)
- **‚ùå Errors** - –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ)

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç wallet_prices fallback, –µ—Å–ª–∏ –≤—Å–µ API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
- –í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞ –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ —á–µ—Ä–µ–∑ fallback —Ü–µ–ø–æ—á–∫—É
- –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `--repeat`, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ –≤—Å–µ–º –∏—Ç–µ—Ä–∞—Ü–∏—è–º

