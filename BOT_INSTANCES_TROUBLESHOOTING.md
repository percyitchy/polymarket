# üîç –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤

## –ü—Ä–æ–±–ª–µ–º–∞

–°–∏–≥–Ω–∞–ª –ø—Ä–∏—à–µ–ª –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è `.env` —Ñ–∞–π–ª–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

### 1. **–ù–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç–∞–Ω—Ü–∏–π –±–æ—Ç–∞ –∑–∞–ø—É—â–µ–Ω–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ**

–ï—Å–ª–∏ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö:
- –ö–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≥—Ä—É–∂–∞–µ—Ç `.env` —Ñ–∞–π–ª **–æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ**
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ `.env` —Ñ–∞–π–ª–∞ **–Ω–µ –≤–ª–∏—è–µ—Ç** –Ω–∞ —É–∂–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
- –ö–∞–∂–¥–∞—è –∏–Ω—Å—Ç–∞–Ω—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –∏ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–≤–æ–π —Å–∏–≥–Ω–∞–ª

### 2. **Race condition –≤ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏**

–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (`is_alert_sent`), –Ω–æ –µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç–∞–Ω—Ü–∏–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Å–∏–≥–Ω–∞–ª –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:
- –û–±–µ –∏–Ω—Å—Ç–∞–Ω—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –ë–î **–¥–æ —Ç–æ–≥–æ**, –∫–∞–∫ –ø–µ—Ä–≤–∞—è —É—Å–ø–µ–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å
- –û–±–µ –≤–∏–¥—è—Ç, —á—Ç–æ —Å–∏–≥–Ω–∞–ª –µ—â–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
- –û–±–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç —Å–∏–≥–Ω–∞–ª

### 3. **–°–µ—Ä–≤–∏—Å –Ω–µ –±—ã–ª –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è .env**

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è `.env` —Ñ–∞–π–ª–∞ **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å, –∏–Ω–∞—á–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω—è—Ç—Å—è.

## üîß –†–µ—à–µ–Ω–∏–µ

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç–∞–Ω—Ü–∏–π –∑–∞–ø—É—â–µ–Ω–æ

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
cd /opt/polymarket-bot
chmod +x check_bot_instances.sh
./check_bot_instances.sh

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
ps aux | grep "[p]olymarket_notifier.py"
pgrep -f "polymarket_notifier.py"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω **—Ç–æ–ª—å–∫–æ 1 –ø—Ä–æ—Ü–µ—Å—Å**.

### –®–∞–≥ 2: –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Å–µ –ª–∏—à–Ω–∏–µ –∏–Ω—Å—Ç–∞–Ω—Ü–∏–∏

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ systemd —Å–µ—Ä–≤–∏—Å
sudo systemctl stop polymarket-bot

# –£–±–µ–π—Ç–µ –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –≤—Ä—É—á–Ω—É—é (–µ—Å–ª–∏ –µ—Å—Ç—å)
pkill -f polymarket_notifier.py

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å
ps aux | grep "[p]olymarket_notifier.py"
```

### –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è .env

**–í–ê–ñ–ù–û:** –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è `.env` —Ñ–∞–π–ª–∞ **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å:

```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ systemd
sudo systemctl restart polymarket-bot

# –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
cd /opt/polymarket-bot
./restart_services.sh
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

```bash
# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
sudo systemctl status polymarket-bot

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
sudo journalctl -u polymarket-bot -f

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Ç–æ–ª—å–∫–æ 1 –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—â–µ–Ω
./check_bot_instances.sh
```

## üìã –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π

1. **–ò–∑–º–µ–Ω–∏—Ç–µ `.env` —Ñ–∞–π–ª** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å:** `sudo systemctl restart polymarket-bot`
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:** `sudo journalctl -u polymarket-bot -f`
4. **–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ç–æ–ª—å–∫–æ 1 –∏–Ω—Å—Ç–∞–Ω—Ü–∏—è:** `./check_bot_instances.sh`

## üö® –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ –±—É–¥—É—â–µ–º

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ –Ω–∞—á–∞–ª–æ `polymarket_notifier.py`:

```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∏–Ω—Å—Ç–∞–Ω—Å –∑–∞–ø—É—â–µ–Ω
import psutil
import os

current_pid = os.getpid()
polymarket_processes = []
for proc in psutil.process_iter(['pid', 'name', 'cmdline']):
    try:
        cmdline = proc.info['cmdline']
        if cmdline and 'polymarket_notifier.py' in ' '.join(cmdline):
            if proc.info['pid'] != current_pid:
                polymarket_processes.append(proc.info['pid'])
    except (psutil.NoSuchProcess, psutil.AccessDenied):
        pass

if polymarket_processes:
    logger.error(f"‚ö†Ô∏è  WARNING: Found {len(polymarket_processes)} other instances running: {polymarket_processes}")
    logger.error("‚ö†Ô∏è  This can cause duplicate alerts! Stopping...")
    sys.exit(1)
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ lock —Ñ–∞–π–ª–∞

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∞–π–ª–æ–≤—ã–π lock –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∑–∞–ø—É—Å–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–Ω—Å—Ç–∞–Ω—Ü–∏–π:

```python
import fcntl
import sys

lock_file = '/tmp/polymarket_bot.lock'
lock_fd = open(lock_file, 'w')
try:
    fcntl.flock(lock_fd, fcntl.LOCK_EX | fcntl.LOCK_NB)
except IOError:
    logger.error("Another instance is already running!")
    sys.exit(1)
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ:

```bash
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
ps aux | grep "[p]olymarket_notifier.py" | wc -l

# –°—Ç–∞—Ç—É—Å systemd —Å–µ—Ä–≤–∏—Å–∞
systemctl status polymarket-bot

# –õ–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
sudo journalctl -u polymarket-bot | grep "BLOCKED: Alert already sent"
```

## üí° –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **`.env` —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ** - –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
2. **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –ë–î** - –µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç–∞–Ω—Ü–∏–π, –≤–æ–∑–º–æ–∂–µ–Ω race condition
3. **Systemd —Å–µ—Ä–≤–∏—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º –∑–∞–ø—É—Å–∫–∞** - –Ω–µ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –±–æ—Ç–∞ –≤—Ä—É—á–Ω—É—é –µ—Å–ª–∏ —Å–µ—Ä–≤–∏—Å –∞–∫—Ç–∏–≤–µ–Ω
4. **–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

